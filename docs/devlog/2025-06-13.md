# Progress

1. Initial Setup
    - Use the kube-hetzner module to define a kube.tf with:
        1. One control plane node (cx21)
        2. One agent node (cpx11)
        3. One autoscaler node pool (cpx11, min=1, max=2)
        4. ARM snapshot: microos_arm_snapshot_id = "242591241"
   - SSH keys were initially marked as sensitive.

2. Debugging Deployment Issues
   - Terraform stalled at _Waiting for MicroOS to become available..._
     - [x] Verified that the snapshot worked by manually provisioning a server with microos_arm_snapshot_id. 
     - [x] Confirmed that SSH worked via CLI: ssh -i ~/.ssh/hetzner_ed25519 root@<IP>. \
     - [x] Resolved issue by making SSH key variables non-sensitve for a clean apply.
     - [x] Marked the variables sensitive on terraform cloud once the plan applied successfully.
     - [x] Tested by destroying and recreating the cluster with sensitive private key.

3. Successful Cluster Deployment
    ```
    38 resources created, including Hetzner Load Balancer, VMs, and autoscaler configuration.
    ```
4. Accessing the Cluster.
    - This required a terraform login (I am using terraform cloud) and terraform init.
    - Setting up terraform cloud as state backend.
        ```hcl
        terraform {
            backend "remote" {
                organization = "level-scale"
                workspaces {
                    name = "level-scale-dev-cluster"
                }
            }
        }
        ```
    - Extracted kubeconfig from Terraform output using:
        ```bash
        terraform output -raw kubeconfig > kubeconfig.yaml
        ```
    - Point `$KUBECONFIG` to the extracted:
       ```bash
       export KUBECONFIG=$PWD/kubeconfig.yaml
       ```

5. Verified cluster connection:
    ```
    kubectl get nodes
    NAME                         STATUS                     ROLES                       AGE   VERSION
    k3s-agent-fsn1-sm-yvy        Ready,SchedulingDisabled   <none>                      25m   v1.31.9+k3s1
    k3s-control-plane-fsn1-qiy   Ready                      control-plane,etcd,master   26m   v1.31.9+k3s1
    k3s-storage-fsn1-sm-qzb      Ready                      <none>                      25m   v1.31.9+k3s1
   ```
